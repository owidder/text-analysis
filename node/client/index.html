<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Tech-Radar</title>

    <link rel="stylesheet" type="text/css" href="/bower_components/materialize/dist/css/materialize.css"
          media="screen,projection"/>
    <link rel="stylesheet" type="text/css" href="/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="/css/material-icons.css"/>

    <script src="/bower_components/bottlejs/dist/bottle.js"></script>
    <script>var bottle = new Bottle();</script>

    <script src="/bower_components/d3/d3.js"></script>
    <script src="/bower_components/lodash/dist/lodash.js"></script>
    <script src="/bower_components/jquery/dist/jquery.js"></script>
    <script src="/bower_components/handlebars/handlebars.js"></script>


</head>

<body>

<script id="subfolders-script" type="text/x-handlebars-template">
    <h2>Folder: <code>{{@root.currentFolder}}</code></h2>
    <table>
        {{#each subfolders}}
        <tr>
            <td><h5><a href="?folder={{@root.currentFolder}}/{{this}}">{{this}}</a></h5> </td>
            <td><b><a href="cloud.html?folder={{@root.currentFolder}}/{{this}}">cloud</a></b> </td>
        </tr>
        {{/each}}
    </table>
</script>

<script src="/js/util/simplePromise.js"></script>
<script src="/js/util/util.js"></script>

<div id="subfolders"></div>

<script>

    /* gobal $ */
    /* global bottle */

    var SimplePromise = bottle.container.SimplePromise;

    var currentFolder = bottle.container.util.param("folder", ".");

    var BASE = 'api/folder/';

    function showSubfolders(subfolders) {
        $("#subfolders").empty();
        var subfoldersTemplateScript = $("#subfolders-script").html();
        var subfoldersTemplate = Handlebars.compile(subfoldersTemplateScript);
        var ctx = {
            currentFolder: currentFolder,
            subfolders: subfolders
        };
        var subfoldersHtml = subfoldersTemplate(ctx);
        $("#subfolders").append(subfoldersHtml);

    }

    function getSubfolders() {
        var p = new SimplePromise();
        var url = BASE + currentFolder;
        $.ajax(url, {
            success: function (data) {
                p.resolve(data.content);
            }
        });

        return p.promise;
    }

    getSubfolders().then(function(data) {
        showSubfolders(data);
    })

</script>
</body>
</html>