Zwei Versionen 5.x auf gleicher Tomcat-Instanz möglich?	"Wir versuchen, zwei Versionen auf einer Tomcat-Instanz zu betreiben. Konkret zwei mal Version 5.3, oder wenn es leichter geht einmal 5.2 und einmal 5.3.

Es werden verschiedene DB-Instanzen (mysql) und verschiedene Index-Directories verwendet.



Problem: die Suche funktioniert entweder bei Instanz 1 oder bei Instanz 2, aber nicht bei beiden.



Sollte das prinzipiell möglich sein? 



Fehlersymptome:

1) Administration/Configuration, Create new index hängt

2) Suche liefert fehlerhafterweise keine Resultate

3) Exceptions, z.B. Exception in thread ""Hibernate Search sync consumer thread for index index.InformationSystemRelease"" java.lang.LinkageError: loader constraint violation: when resolving method ""java.lang.invoke.MethodHandle.invokeExact()Lorg/apache/lucene/util/AttributeImpl;"" the class loader (instance of org/apache/catalina/loader/WebappClassLoader) of the current class, org/apache/lucene/util/AttributeFactory$1, and the class loader (instance of <bootloader>) for resolved class, java/lang/invoke/MethodHandle, have different Class objects for the type ; used in the signature



mfg

Stefan Neubauer

UNIQA IT Services GmbH

stefan.neubauer@uniqa.at

+43 664 823 29 66

"		Technical question	iteraplan Support	13/Oct/16 4:20 PM	22/Oct/16 9:55 AM														"14/Oct/16 3:53 PM;cst;Sehr geehrter Herr Neubauer,

vielen Dank für Ihre Anfrage.

Um das Problem genauer analysieren zu können benötigen wir folgende Log-Files.

Aus dem conf-Verzeichnis Ihrer Tomcat-Installation:
•	server.xml
•	web.xml

Die catalina.out und localhost.log Logdateien Ihrer Tomcat-Installation aus dem Zeitraum, in dem der Fehler aufgetreten ist.
Aus [Tomcat]/webapps/[iteraplan Installationsverzeichnis]/WEB-INF:

•	Sämtliche Dateien, deren Name mit applicationContext beginnt.

Aus [Tomcat]/webapps/[iteraplan Installationsverzeichnis]/WEB-INF/classes:

•	log4j.properties

Aus [Tomcat]/webapps/[iteraplan Installationsverzeichnis]/META-INF:
•	context.xml (Die Datei kann Passwörter enthalten, bitte entfernen oder verfremden)

Die iteraplan Logdatei bzw. Dateien aus dem Zeitraum, in dem der Fehler aufgetreten ist. In Ihrem Fall bitte von den zwei unterschiedlichen iteraplan instanzen.

Diese Dateien tragen üblicherweise den Namen iteraplan-[version].log (für den aktuellen Tag) bzw. iteraplan-[version].log.[TIMESTAMP] für vergangene Tage. Der Ablageort dieser Logdateien wurde bei der iteraplan-Installation angegeben und kann bei Bedarf in der Datei log4j.properties nachgesehen werden.

Die iteraplan System-Info. Diese kann von iteraplan-Benutzern mit der Rolle „iteraplan_Supervisor“ direkt von der iteraplan-Oberfläche unter 
dem Menüpunkt Administration->Konfiguration abgerufen werden.

Viele Grüße,

Christoph Stangl - iteraplan Support "	"17/Oct/16 11:12 AM;stefan.neubauer@hackhofer.at;Sehr geehrter Herr Stangl, 

siehe iteraplan-2instanzen-search-does-not-work.zip für die files
instanz1-v530: unsere bisherige produktionsversion
instanz1-v520: habe dann im zuge der tests diese auf v520 downgegraded
instanz2: neue instanz (v530), mit context root iteraplanTom

Installiert und herumprobiert habe ich damit vor allem am 13.10.2016.

mfg
Stefan Neubauer"	"17/Oct/16 11:13 AM;stefan.neubauer@hackhofer.at;

[^iteraplan-2instanzen-search-does-not-work.zip] _(132 kB)_"	"18/Oct/16 9:58 AM;cst;Sehr geehrter Herr Neubauer, 



vielen Dank für die Zusendung der Files. 



Würden Sie bitte die Ordner der ""Indexe"" leeren und den Tomcat neu starten. Hier ist darauf zu achten, das dieser mit Administrationsrechten ausgeführt wird.

Wären dem Neustart werden die ""Indexe"" neu geschrieben, dies kann die Ursache für das von Ihnen gemeldete verhalten sein.



Zusätzlich prüfen Sie bitte die Zeile ""hibernate.search.index=""Pfad"" in der Datei ""iteraplan.properties"" unter ""[Tomcat]/webapps/[iteraplan Installationsverzeichnis(5.2/.5.3)]/WEB-INF/classes"" ob hier die korrekten Pfade zum ""Index"" konfiguriert sind. 



Ihre Mail mit Ihren anderen Fragen habe ich bekommen und wenn die Software wieder ohne Probleme bei Ihnen funktioniert, werde ich mit Ihnen diese besprechen.



Viele Grüße,



Christoph Stangl - iteraplan Support "	"18/Oct/16 1:59 PM;stefan.neubauer@hackhofer.at;Sehr geehrter Herr Stangl,

die Einstellung hibernate.search.index passt.

$ cat iteraplan/WEB-INF/classes/iteraplan.properties | grep -i hibernate.search.index
hibernate.search.index=/data/iteraplan/indexes52

$ cat iteraplanTom/WEB-INF/classes/iteraplan.properties | grep -i hibernate.search.index
hibernate.search.index=/data/iteraplan/indexes53tom

Diese Verzeichnisse hatte ich bereits Donnerstag geleert und den Index neu erstellt. Das sieht so aus dass der erste gewinnt. Also bei der ersten Instanz funktioniert es, bei der zweiten kommt der Fehler und man kann nicht suchen. Wir hatten schon beide Konstellationen, also dass ""iteraplan"" funktioniert aber ""iteraplanTom"" nicht, oder umgekehrt.

lg Stefan Neubauer"	"19/Oct/16 10:17 AM;cst;Sehr geehrter Herr Neubauer,



vielen Dank für Ihre Antwort. 



Um das Verhalten näher prüfen zu können, noch einige Frage zur Konfiguration. Werden hier zwei unterschiedliche Datenbanken verwendet, oder verbinden sich beide Instanzen mit der gleichen Datenbank? Welche Datenbank wird eingesetzt (Oracle, Microsoft SQL, oder MYSQL)? 



Generell ist es möglich zwei Instanzen auf  einem Tomcat zu betreiben, werde aber für weitere Rückschlüsse Ihr Szenario nachstellen. 

Arbeiten Sie in beiden Instanz mit der gleichen LDAP Anmeldung, oder sind das hier verschiedene Benutzer?



Zusätzlich werde ich den Vorgang heute noch mit unseren Entwicklern besprechen, um das Problem weiter zu analysieren. 



Vielen Grüße,



Christoph Stangl - iteraplan Support"	"19/Oct/16 11:38 AM;stefan.neubauer@hackhofer.at;Sehr geehrter Herr Stangl,

es werde zwei Datenbanken verwendet, jeweils mysql. Ein Kollege hat die letzten Tage versucht die ""iteraplanTom""-Instanz zu verwenden, hat aber auch ohne Verwendung der Suchfunktion nicht funktioniert (immer wieder ""hängengeblieben"").

Aktuell haben wir zwei Server auf denen wir Iteraplan betreiben.  Einmal Test, einmal Produktion. Als Workaround habe ich auf dem Test-server die Test-Instanz undeployed und die ""iteraplanTom"" Instanz deployed. Auf dem Produktions-Server die ""iteraplanTom"" undeployed. Damit läuft alles wieder problemlos, nur haben wir vorübergehend keine Test-Instanz um Sachen auszuprobieren bzw. für Schulungen.

lg Stefan Neubauer"	"19/Oct/16 12:37 PM;cst;Hallo Herr Neubauer,

habe mit unseren Entwicklern gesprochen und wir konnten eine Spur aufnehmen, die auf zwei Verdächtige hindeutet.
Die ""iteraplan.properties"" und ""iteraplan_local.properties"" der jeweiligen Instanzen benötigen wir noch, um dieser Spur weiter zu verfolgen.

Viele Grüße,

Christoph Stangl - iteraplan Support "	"20/Oct/16 10:33 AM;stefan.neubauer@hackhofer.at;

[^iteraplan.properties.52prod] _(14 kB)_

[^iteraplan.properties.53tom] _(14 kB)_

[^iteraplan_local.properties.52prod] _(0.6 kB)_

[^iteraplan_local.properties.53tom] _(0.6 kB)_"	"20/Oct/16 11:04 AM;cst;Hallo Herr Neubauer,

folgendes sticht mir ins Auge.

java.nio.file.NoSuchFileException: /data/iteraplan/indexes53/index.InfrastructureElement

Habe die Files überprüft und mir ist aufgefallen das bei einem der Konfigurationen ""indexes53"" angesprochen wird.
In den Dateien ist der korrekte Pfad eingetragen. Kann es sein, das er im ""Work"" Verzeichnis des Tomcats hier noch andere Werte gespeichert hat. 
Hatte der Pfad jemals existiert, also bei erst Installation z.B.?

Die in ""iteraplan"" Konfiguration von Beiden Instanzen weißen keine Unregelmäßigkeiten auf, die dieses Verhalten erklären und das Verhalten erklärt. 
Wir empfehlen normalerweise pro ""iteraplan instanz"" einen seperaten Tomcat-Server, aber in der Praxis sollte dies kein Problem darstellen zwei Instanzen iteraplan auf einem Tomcat laufen zu lassen. 

Berechtigungen auf die ""Index"" Verzeichnisse scheinen auch ausreichend vorhanden sein.

Prüfen Sie nochmals den Punkt mit dem ""Work"" Verzeichnis des Tomcats, wenn dies nicht zu Lösung führt empfehlen wir hier die zweite Instanz auf einem Separaten Tomcat Server laufen zu lassen. 

Viele Grüße,

Christoph Stangl - iteraplan Support 


"	"20/Oct/16 1:51 PM;stefan.neubauer@hackhofer.at;Hallo Herr Stangl,

das ""Create new index"" bleibt hängen, das NoSuchFileException ist wohl eine Folge davon. 

Der Pfad hat existiert, die Pfade passen auch. Wenn man ""Create new index"" ausführt sieht man auch dass die Dateien in den richtigen Foldern erstellt werden (aber bei einer der beiden Instanzen nicht vollständig). 

Bei einer Instanz ist die history aktiviert, bei der anderen nicht. Schätze das sollte aber nicht diese Probleme verursachen.

:(

lg Stefan Neubauer"	"20/Oct/16 2:07 PM;cst;Hallo Herr Neubauer,

wir können hierzu auch gerne einmal Telefonieren. 
Würden Sie mir bitte Ihre Rufnummer hierzu mitteilen.

Grüße,

Christoph Stangl - iteraplan Support "	"20/Oct/16 2:10 PM;stefan.neubauer@hackhofer.at;Ja, das würe fein:
+43 1 21366 4970
+43 664 823 29 66"	"20/Oct/16 2:43 PM;cst;Hallo Herr Neubauer,

nach einigen Recherchen im Internet mit hibernate search - Tomcat 7 und Linux habe ich einen Ansatz gefunden woher das Verhalten kommen kann.
Würden Sie bitte das aktuelle Update von JDK einspielen. Sie haben eine Version jdk1.7.0_25 - nach Angabe gab es hier ""ähnlich"" gelagerte Fälle die durch ein Update auf die aktuelle Version behoben wurde.

Viele Grüße,

Christoph Stangl - iteraplan Support 
"	"21/Oct/16 9:24 PM;stefan.neubauer@hackhofer.at;Hallo Herr Stangl,

das war ein wirklich guter Tipp. Upgrade auf JDK 1.7.0_80, mit erbaulichen Resultaten: ""Create new index"" kann bei beiden Instanzen gemacht werden, Suche funktioniert in beiden Instanzen, keine Abstürze bisher!

Besten Dank für die Unterstützung!
Stefan Neubauer & Kollegen"																																								
