Messausfall bei Nicht-Erreichbarkeit von GraphiteServern	"Wir haben am  Wochenende 18.03.2017 bis Montag Morgen 20.03. einen Mess-Ausfall in der OTTO-Instanz gehabt:



[https://iteraspeedmonitor.otto.wpt.iteratec.de/eventResultDashboard/showAll?_action_showAll=Anzeigen&selectedInterval=-1&selectedTimeFrameInterval=0&_setFromHour=&from=17.03.2017&fromHour=10%3A11&_setToHour=&to=20.03.2017&toHour=10%3A11&selectedFolder=7&selectedPages=1&_selectedAllMeasuredEvents=&selectedAllMeasuredEvents=on&_selectedAllBrowsers=&selectedAllBrowsers=on&_selectedAllLocations=&selectedAllLocations=on&_selectedAllConnectivityProfiles=&selectedAllConnectivityProfiles=on&selectedAggrGroupValuesUnCached=docCompleteTimeInMillisecsUncached&trimBelowLoadTimes=&trimAboveLoadTimes=&trimBelowRequestCounts=&trimAboveRequestCounts=&trimBelowRequestSizes=&trimAboveRequestSizes=]



Hierbei sind die Messungen nicht komplett ausgefallen, sondern es gab nur noch sehr wenige erfolgreiche Messungen. In den Logs der Instanz sieht man seit Samstag früh, 07:00 Uhr (hier war unser Graphite ausgefallen) viele der folgenden Logeinträge:



 

{code:java}

4690 [18.03.2017 08:58:21] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4691 [18.03.2017 09:00:29] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4692 [18.03.2017 09:02:37] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4693 [18.03.2017 09:04:45] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4694 [18.03.2017 09:06:53] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4695 [18.03.2017 09:09:01] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4696 [18.03.2017 09:11:09] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4697 [18.03.2017 09:13:17] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4698 [18.03.2017 09:15:25] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4699 [18.03.2017 09:17:33] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4700 [18.03.2017 09:19:41] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4701 [18.03.2017 09:21:49] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4702 [18.03.2017 09:23:57] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4703 [18.03.2017 09:26:05] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4704 [18.03.2017 09:28:13] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4705 [18.03.2017 09:30:21] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4706 [18.03.2017 09:32:29] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4707 [18.03.2017 09:34:37] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4708 [18.03.2017 09:36:45] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4709 [18.03.2017 09:38:53] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4710 [18.03.2017 09:41:01] [THREAD ID=quartzScheduler_Worker-7] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003 

4711 [18.03.2017 09:43:27] [THREAD ID=quartzScheduler_Worker-4] ERROR grails.app.services.de.iteratec.osm.report.external.MetricReportingService : de.iteratec.osm.report.external.GraphiteComunicationFailureException: Failed to communicate 

    with server monitoring.hh.iteratec.de/88.198.110.136 on port 2003



{code}

Im Anhang dieses Issues ist das gesamt Logging des 18.03. zu finden.



 



Wir haben zwar dafür gesorgt, dass die Transaktionen für das Speichern von `EventResults` und nachgelagerten Aktionen wie die CSI-Aggregation und das Schreiben ins Graphite getrennt werden, sodass es aufgrund des Scheiterns nachgelagerter Aktionen keine Rollbacks der EventResult-Transaktionen geben kann.



Anscheinend bremst hier aber ein zu langes Timeout des Connection-Aufbaus zum Graphite das JobProcessing insgesamt so stark aus, dass nicht mehr genügend Jobs prozessiert werden.



Dies sollten wir verhindern. Mögliche Lösungen wären

 * das explizite Setzen eines geringeren Timeouts für die HTTP-Verbindung.

 * Vergrößerung des Thread-Pools.

 * Senden der Daten zu Graphite per UDP statt per TCP ermöglichen. "		Bug	OpenSpeedMonitor	20/Mar/17 10:29 AM	22/Mar/17 11:28 AM														"22/Mar/17 11:28 AM;mmi;Wir können jetzt UDP ;)

Das TCP-Timeout wurde auf 3sek gesetzt"																																																						
