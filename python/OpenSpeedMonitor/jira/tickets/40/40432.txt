Nächtlicher Batch-Job zur Abfrage von Graphite-Daten	"Um externe Daten als Events mit darstellen zu können sollten wir eine Möglichkeit schaffen nächtlich Daten aus Graphite zu lesen und entsprechende Events zu schreiben.



*Mail von Uwe zur Abfrage von Daten aus Graphite (bei OTTO):*



Hier ist die Diagrammdarstellung für den Zeitraum 11.05. 08:00-08:59

http://graphoo.ops.live.lhotse.ov.otto.de/edit?uri=aHR0cDovL2dyYXBoaXRlLm90dG8ubmV4aW50by5jb20vcmVuZGVyLy8/dGl0bGU9RGVwbG95bWVudHMraW5jbC4rVmFybmlzaC1BcHBseSZmcm9tPTA3JTNBMDBfMjAxNTA1MTEmdW50aWw9MDclM0E1OV8yMDE1MDUxMSZ3aWR0aD0xNTAwJmhlaWdodD01MDAmdGFyZ2V0PWFsaWFzQnlOb2RlJTI4ZHJhd0FzSW5maW5pdGUlMjhkZXBsb3ltZW50cy5saXZlLiouY291bnQlMjklMkMyJTI5JnRhcmdldD1hbGlhc0J5Tm9kZSUyOGRyYXdBc0luZmluaXRlJTI4Y210LmNoYW5nZXMuKiUyOSUyQzIlMjkmdnRpdGxlPURlcGxveW1lbnQmYXJlYU1vZGU9bm9uZSZoaWRlTGVnZW5kPWZhbHNlJmhpZGVHcmlkPXRydWUmdGVtcGxhdGU9bGhvdHNlLWxpZ2h0JnVybD1odHRwJTNBJTJGJTJGZ3JhcGhpdGUub3R0by5uZXhpbnRvLmNvbSUyRnJlbmRlciUyRiUyRg==



Die eigentliche Grafik-URL sieht dafür so aus

http://graphite.otto.nexinto.com/render//?title=Deployments+incl.+Varnish-Apply&from=07%3A00_20150511&until=07%3A59_20150511&width=1500&height=500&target=aliasByNode%28drawAsInfinite%28deployments.live.*.count%29%2C2%29&target=aliasByNode%28drawAsInfinite%28cmt.changes.*%29%2C2%29&vtitle=Deployment&areaMode=none&hideLegend=false&hideGrid=true&template=lhotse-light&url=http%3A%2F%2Fgraphite.otto.nexinto.com%2Frender%2F%2F



bzw. ohne URL-Encoding

http://graphite.otto.nexinto.com/render//?title=Deployments incl. Varnish-Apply&from=07:00_20150511&until=07:59_20150511&width=1500&height=500&target=aliasByNode(drawAsInfinite(deployments.live.*.count),2)&target=aliasByNode(drawAsInfinite(cmt.changes.*),2)&vtitle=Deployment&areaMode=none&hideLegend=false&hideGrid=true&template=lhotse-light&url=http://graphite.otto.nexinto.com/render//



Wenn Du die Daten nicht als Bild sondern als JSON-bjekt bekommen möchtest, dann kannst Du die meisten Parameter einfach weglassen. Dafür benötigst Du zusätzlich die Angabe format=json als Parameter

http://graphite.otto.nexinto.com/render/?format=json&from=07:00_20150511&until=07:59_20150511&target=aliasByNode(deployments.live.*.count,2)&target=aliasByNode(cmt.changes.*,2)"		New Feature	OpenSpeedMonitor	12/May/15 1:48 PM	29/May/15 3:26 PM														"18/May/15 1:40 PM;bwo;*Vorgehen*:

* Neue Domains:

** GraphiteEventSourcePaths



* Neue Beziehungen:

** GraphiteServer 1:n GraphiteEventSourcePath

** GraphiteSourcePath 1:n JobGroup



* Neuer QuarzJob:

** Iteriert nächtlich über alle GraphiteServer, sammelt alle EventSourcePaths, fragt diese ab und erstellt aus den Ergebnissen Events. Da jeder EventSourcePath seine JobGroups kennt, können diese direkt zugeordnet werden. "	26/May/15 11:37 AM;bwo;Sollte soweit funktionieren, bitte noch einmal überprüfen.	29/May/15 3:26 PM;nku;Habe das noch mal ziemlich umgebaut und einen Test geschrieben, der die gesamte Funktionalität besser testet.																																																				
