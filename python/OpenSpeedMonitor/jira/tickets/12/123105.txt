neuer Client lädt nicht	"Um das hier auch als Ticket zu tracken...



""So wie es aussieht scheint es vom Standort abzuhaengen, also in DE laedt er (schnelle Anbindung) in UK nicht (langsame Anbindung).""



Ich hatte bisher den angehängten Timeout Patch geschickt, der allerdings noch nicht eingespielt wurde.



Die Anleitung dazu war:

""As just mentioned on the phone I’d like to exchange one file to increase the timeout to see if the issue with the new client is related to time.

What needs to be done?

1.	Replace iteraplan-elastic-core-mi-4.13.0.jar in the WEB-INF/lib folder with iteraplan-elastic-core-mi-4.14.0.jar from the attached zip package.

2.	Restart iteraplan""



Allerdings gibt es bereits Version 14 auf deren Installation. Die Frage war nun, ob wir dann nich eine gepatchte v15 brauchen."		Fault	iteraplan Support	01/Jun/17 8:52 AM	27/Jun/17 12:53 PM														"01/Jun/17 8:52 AM;dne;

[^timeout_patch.zip] _(615 kB)_"	"01/Jun/17 4:23 PM;msr;Hallo Daniel,

mir ist nicht klar, was ""Version 14"" und gepatchte v15 bedeutet.

Gibt es hier eine offene Frage oder wartest du auf Antwort von EON?

VG

Marcel"	"01/Jun/17 4:32 PM;dne;Die Aussage von Christoph (im Original Stephan) war, dass wir die iteraplan-elastic-core-mi-4.13.0.jar mit der zur Verfügung gestellten, gepatchten iteraplan-elastic-core-mi-4.14.0.jar ersetzen sollen. Auf dem Server bei E.ON gibt es aber bereits eine iteraplan-elastic-core-mi-4.14.0.jar statt einer iteraplan-elastic-core-mi-4.13.0.jar.

Die Frage ist nun, ob sich die iteraplan-elastic-core-mi-4.14.0.jar auf dem Server, die wohl mit dem Installer ausgeliefert wurde von der gepatchten iteraplan-elastic-core-mi-4.14.0.jar aus diesem Ticket unterscheidet oder nicht. Nicht, dass sowohl Stephan eine v14 erstellt hat, die lediglich den Timeout hochsetzt und das Entwicklerteam generell inzwischen eine v14 erstellt hat, die auch andere Änderungen enthält ;)

Ich hatte gehofft, Christoph kann mir das einfach so beantworten. Werde nun aber E.ON bitten, mir deren v14 zu schicken, dann vergleich ich sie selbst. Sollte es die gleiche Datei sein, haben wir dahingehend ein Problem, dass der neue Client trotz längerem Timeout gar nicht lädt aus UK.

Ich hoffe das war verständlich genug, sonst sollten wir kurz telefonieren ;)"	"06/Jun/17 8:59 AM;dne;Am Freitag hat mir E.ON eine Reihe an Fehlern vorgeführt, unter anderem eben auch, dass der neue Client nicht lädt. Dazu gibt es ein paar neue Infos: Es gibt auch in UK Nutzer, bei denen der Client lädt, z.T. auch in wenigen Minuten. Bei Karen hingegen bricht der Versuch die Daten zu laden nach zwei Minuten ab. Folgende Fehlermeldung haben wir spontan aus der Browser-Konsole gefischt.

Wie lässt sich das näher untersuchen?

DOM7011: The code on this page disabled back and forward caching. For more information, see: http://go.microsoft.com/fwlink/?LinkID=291337
File: client
HTML1300: Navigation occurred.
File: client
HTML1202: https://test-eam-tool.intranet.uniper.energy/iteraplan/client/ is running in Compatibility View because 'Display intranet sites in Compatibility View' is checked.
File: client
TypeError: An exception occurred: Unable to get property 'presentationType' of undefined or null reference
   at SimpleProperty (https://test-eam-tool.intranet.uniper.energy/iteraplan/client/js/combined1491309332865.js:1:28670)
   at Anonymous function (https://test-eam-tool.intranet.uniper.energy/iteraplan/client/js/combined1491309332865.js:1:30627)
   at Type (https://test-eam-tool.intranet.uniper.energy/iteraplan/client/js/combined1491309332865.js:1:30555)
   at Anonymous function (https://test-eam-tool.intranet.uniper.energy/iteraplan/client/js/combined1491309332865.js:1:26950)
   at MetaModel (https://test-eam-tool.intranet.uniper.energy/iteraplan/client/js/combined1491309332865.js:1:26899)
   at DataModel (https://test-eam-tool.intranet.uniper.energy/iteraplan/client/js/combined1491309332865.js:1:18261)
   at Anonymous function (https://test-eam-tool.intranet.uniper.energy/iteraplan/client/js/combined1491309332865.js:1:25664)
   at h (https://test-eam-tool.intranet.uniper.energy/iteraplan/client/js/comb"	"06/Jun/17 5:00 PM;msr;Hallo Daniel,

wie telefonisch besprochen sieht der Stacktrace nach falschen/unvollständigen Daten im Neuen Client aus. Dazu sollten wir die Daten, die der Server schickt, auf zwei verschiedenen Clients vergleichen. Hier die Anleitung für den Internet Explorer 11.

Wir vergleichen die Resultate der REST-Abfragen an
{code:java}
[ITERAPLAN]/api/icd
{code}

* Öffne die Entwicklerkonsole im Internet Explorer mit F12.
* Öffne den Tab ""Netzwerk""
* Klicke auf das Icon zum Aufzeichnen aktivieren
* Erst jetzt logge dich ein (dadurch wird der Request an ""[ITERAPLAN]/api/icd"" ausgelöst oder bei einem Reload
* Es erscheint eine Übersicht aller Requests !Übersicht Request.png|thumbnail! 
* Hier siehst du schon, wie groß das Datamodel ist (z.B.0,66 MB)
* Genauer geht es, wenn du den Request mit Doppelklick öffnest und den Antworttext anschauen. Dies ist die komplette Struktur und sollte gleich sein:
*  !Detailansicht.png|thumbnail! 

Viel Erfolg mit unserem ersten Verdacht. Halte mich auf dem Laufenden

Marcel"	"07/Jun/17 1:43 PM;dne;Haben jetzt erst einmal einen Testlauf bei einem Nutzer gemacht, bei dem es nicht funktioniert. Die Aufzeichnung ist angehängt.

Die entscheidende Stelle ist folgende. Der Content kommt zwar mit (36 MB), allerdings nicht in lesbarer Form (komprimiert + unvollständig?).

{
                ""startedDateTime"": ""2017-06-07T10:44:19.968Z"",
                ""time"": 136031,
                ""request"": {
                    ""method"": ""GET"",
                    ""url"": ""https://test-eam-tool.intranet.uniper.energy/iteraplan/api/icd"",
                    ""httpVersion"": ""HTTP/1.1"",
                    ""cookies"": [ ... ],
                    ""headers"": [
                        {
                            ""name"": ""Accept"",
                            ""value"": ""application/json, text/plain, */*""
                        },
                        {
                            ""name"": ""Accept-Encoding"",
                            ""value"": ""gzip, deflate""
                        },
                        {
                            ""name"": ""Accept-Language"",
                            ""value"": ""en-GB""
                        },
                        {
                            ""name"": ""Connection"",
                            ""value"": ""Keep-Alive""
                        },
                        {
                            ""name"": ""Cookie"",
                            ""value"": ""JSESSIONID=A2A753AB7AEA42489DBEBA99FDD33B8F; SessionID=8d1229d1.5515c641bcf7f""
                        },
                        {
                            ""name"": ""DNT"",
                            ""value"": ""1""
                        },
                        {
                            ""name"": ""Host"",
                            ""value"": ""test-eam-tool.intranet.uniper.energy""
                        },
                        {
                            ""name"": ""Referer"",
                            ""value"": ""https://test-eam-tool.intranet.uniper.energy/iteraplan/client/""
                        },
                        {
                            ""name"": ""User-Agent"",
                            ""value"": ""Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; InfoPath.3)""
                        }
                    ],
                    ""queryString"": [],
                    ""headersSize"": 514,
                    ""bodySize"": -1
                },
                ""response"": {
                    ""status"": 200,
                    ""statusText"": ""OK"",
                    ""httpVersion"": ""HTTP/1.1"",
                    ""cookies"": [],
                    ""headers"": [
                        {
                            ""name"": ""Accept-Ranges"",
                            ""value"": ""bytes""
                        },
                        {
                            ""name"": ""Cache-Control"",
                            ""value"": ""no-cache, no-store, must-revalidate""
                        },
                        {
                            ""name"": ""Connection"",
                            ""value"": ""Keep-Alive""
                        },
                        {
                            ""name"": ""Content-Length"",
                            ""value"": ""37872207""
                        },
                        {
                            ""name"": ""Content-Type"",
                            ""value"": ""application/json; charset=UTF-8""
                        },
                        {
                            ""name"": ""Date"",
                            ""value"": ""Wed, 07 Jun 2017 10:44:51 GMT""
                        },
                        {
                            ""name"": ""ETag"",
                            ""value"": ""\""1496601582631\""""
                        },
                        {
                            ""name"": ""Keep-Alive"",
                            ""value"": ""timeout=15, max=94""
                        },
                        {
                            ""name"": ""Server"",
                            ""value"": ""Restlet-Framework/2.2.0""
                        }
                    ],
                    ""content"": {
                        ""size"": 37872207,
                        ""compression"": -298,
                        ""mimeType"": ""application/json"",
                        ""text"": """"
                    },
                    ""redirectURL"": """",
                    ""headersSize"": 298,
                    ""bodySize"": 37872505
                },
                ""cache"": {},
                ""timings"": {
                    ""blocked"": 0,
                    ""dns"": -1,
                    ""connect"": -1,
                    ""send"": 0,
                    ""wait"": 31897,
                    ""receive"": 104134,
                    ""ssl"": -1
                }
            }

[^iteraplan_IAClient01.7z] _(1,06 MB)_"	07/Jun/17 1:45 PM;dne;[^logs-after.tgz] _(8 kB)_	07/Jun/17 4:42 PM;dne;!Ladezeit.png|thumbnail!	08/Jun/17 2:27 PM;fka;Scheint also beim Kunden zu liegen...	"08/Jun/17 3:13 PM;dne;Update von Alex:
""Ich habe jetzt zwei Leute gefunden, bei denen hat es ganz zu Anfang mal funktioniert, jetzt aber nicht mehr…
Gleiches Verhalten: Leere Antwort.""

Haben also leider keine Referenz"	08/Jun/17 3:14 PM;dne;Gibt es eine Möglichkeit die Komprimierung zu deaktivieren, in der Hoffnung erkennen zu können, an welchem Datum es scheitert? Ich vermute mal in der DB ist irgendwas nicht so wie es sein sollte.	"12/Jun/17 11:46 AM;dne;Komprimierung ist nicht aktiviert. Daten kommen einfach nicht an (Response Body leer).
Können wir den Request auch direkt an den Server schicken, z.B. über Postman?"	"12/Jun/17 12:09 PM;dne;Das Problem tritt Browser-unabhängig auf. Die Ladezeit bei IE 11 war zuletzt 11 Sekunden, bei FireFox 6.

Tomcat-Cache und Browser-Cache waren geleert."	12/Jun/17 2:31 PM;dne;Bedenkt bitte: Uniper hat einen Apache HTTP Server im Einsatz	"12/Jun/17 5:31 PM;fka;Hi Daniel,



stellt sich für uns so dar, als ob das Problem nicht bei iteraplan, sondern am speziellen Setup beim Kunden liegt. Denn: Leeren Repsonse haben wir bisher noch nicht gesehen, es passiert Browser-unabhängig, es gibt eine vernünftige Ladezeit (keine sofortige Antwort), etc.



Für eine genaueres Einkreisen fallen uns als mögliche Ursache ein:

 * Am Client: Virenscanner/Netzwerkwächter o.ä., welcher den Content blockiert. Aus meiner Sicht einer der Hauptverdächtigen ...

 * Im Netzwerk: Proxy etc., die filtern

 * Am Server: Timeouts, z.B. im Apache



Zum Testen: Postman ist eine gute Idee. Ressource am Server ist genau wie in deinem Screenshot zu sehen: ""icd"".



Viele Grüße

Fabian



 "	"16/Jun/17 2:32 PM;dne;So leicht kommt ihr mir nicht davon ;)

Konnte das Problem inzwischen bei mir lokal nachstellen. Ursache ist vmtl. eine fehlerhafte Datenbankmigration von 3.4 auf 5.5. Allerdings verstehe ich noch nicht, wo der Fehler passiert ...

Ich habe eine funktionierende Kopie der Produktionsdatenbank durch Ausführen der SQL Skripte 01_ ... bis 10_ ... (siehe Anhang) migriert.

Im Ergebnis habe ich dann einige IS, die eine Beziehung zum IE-Wurzelelement ""-"" haben. Das führt dann u.A. dazu, dass der Import nicht mehr funktioniert. Ob noch andere Sachen kaputt sind, weiß ich nicht. Der neue Client lädt daraufhin jedoch nicht, der alte geht.

Die Datenbank vor und nach Migration könnt ihr hier einsehen: https://www.dropbox.com/sh/xc0lis2qiabozdg/AACYAvc_2kz0AG89EkPPKuQNa?dl=0

[^sql scripts.zip] _(1,45 MB)_"	"16/Jun/17 2:44 PM;fka;Hallo Daniel,

stellt sich für uns so dar, als ob das Problem nicht bei iteraplan, sondern am speziellen Setup beim Kunden liegt. Denn: Die DB-Migration hat bisher immer funktioniert. Vielleicht waren die Daten vorher schon kaputt, es ist nur nicht aufgefallen, weil der Interactive Client bisher nicht genutzt wurde...?

Hast du noch Zugriff auf den DB-Stand 3.4? Kannst du schauen, ob dort diese komischen Wurzelelementzuordnung dort schon so ist? Wenn nicht, kannst du jedes Migrationsskript (pro iteraplan-Version) einzeln durchführen und schauen, ab wann sich der Fehler einschleicht?

Danke dir & viele Grüße
Fabian

 

 "	16/Jun/17 2:45 PM;fka;Dies könnte z.B. (vor langer Zeit) passiert sein, als die Beziehung IS-IE attributierbar wurde.	"16/Jun/17 4:03 PM;msr;Hi Daniel,



hier Fabians Antwort (er ist schon mit einem Fuß im Urlaub):



""Hallo Daniel,



stellt sich für uns so dar, als ob das Problem nicht bei iteraplan, sondern am speziellen Setup beim Kunden liegt. Denn: Die DB-Migration hat bisher immer funktioniert. Vielleicht waren die Daten vorher schon kaputt, es ist nur nicht aufgefallen, weil der Interactive Client bisher nicht genutzt wurde...?



Dies könnte z.B. (vor langer Zeit) passiert sein, als die Beziehung IS-IE attributierbar wurde.



Hast du noch Zugriff auf den DB-Stand 3.4? Kannst du schauen, ob dort diese komischen Wurzelelementzuordnung dort schon so ist? Wenn nicht, kannst du jedes Migrationsskript (pro iteraplan-Version) einzeln durchführen und schauen, ab wann sich der Fehler einschleicht?



Danke dir & viele Grüße

Fabian"""	"19/Jun/17 8:50 AM;dne;Hi, ich bin heute und morgen bei der Swiss Life und komme nicht dazu. Die DB in Version 3.4 sowie 5.5 ist über die Link aus meinem letzten Eintrag verfügbar. Die angewandten Skripte liegen im Anhang. 
Nachdem bei E.ON keiner direkt mit der Datenbank arbeitet (läuft über HP) wenn nicht gerade ein Update ansteht scheinen die Migrationsskripte nicht korrekt zu sein. Prüft das bitte kurzfristig - wir machen nun schon seit Anfang des Monat damit herum."	"21/Jun/17 3:18 PM;dne;Habe die falschen Zuordnungen per Skript nun alle gelöscht, was das Import-Problem löst, dem neuen Client aber nicht auf die Sprünge hilft. 

Habt ihr schon herausfinden können, welcher Eintrag in der DB Ärger bereitet? Ohne Debugging komme ich da nicht mehr weiter...

[^remove_root_relations.sql] _(2 kB)_"	21/Jun/17 4:31 PM;dne;Bin noch dabei, das Problem weiter einzugrenzen. Habe mir mal den Netzwerk-Traffic zwischen iteraplan und meinem Rechner angeschaut und siehe da, die vollen 78 MB Daten werden übertragen. Der Browser verweigert bloß scheinbar die Annahme oder verwirft den Body.	22/Jun/17 9:44 AM;dne;Hatte inzwischen auch schon einmal einen Großteil der Daten gelöscht, ohne Erfolg. Liegt wohl weniger an der Menge als mehr an der Metamodellstruktur. Bin heute und morgen außer Landes.	"22/Jun/17 4:38 PM;msr;[~cst]: Bitte im Detail anschauen, wie man Ansätze finden kann, um EON zu helfen.
Ich könnte mir auch vorstellen, dass wir einen Datenbank-Dump zur weiteren Analyse benötigen könnten. Aber ich bin mir nicht sicher."	"26/Jun/17 8:22 AM;cst;Guten Morgen Daniel,

Marcel hatte hier schon den richtigen Riecher, würde mir das ganze mit der Datenbank von EON anschauen. 
Dann analysiere ich das Schritt für Schritt. 

Können gerne auch hier kurz telefonieren. 

Viele Grüße,

Christoph Stangl - iteraplan Support"	26/Jun/17 11:03 AM;dne;Bin schon wieder ein bisschen weiter: Es liegt am Attribut "Retention Status". Lösche ich das, lädt der neue Client.	26/Jun/17 11:33 AM;cst;Korrekt, muss jetzt das ganze zurück spielen und schauen mir den Aufbau des Attributes an. 	27/Jun/17 12:34 PM;dne;Die Lösung das Merkmal "Status" umzubenennen funktioniert auch bei E.ON / Uniper. Dort starten jetzt die nächsten Test. Aus meiner Sicht kann man das Ticket hier schließen.																											
