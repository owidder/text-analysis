Upgrading from Iteraplan  corporate edition 5.0 to 5.4 	"Hi,



We are attempting to upgrade our iteraplan version from v5.0.0-r24731 to 5.4, however it seems from the installation guide that we would need to upgrade from 5.0 to 5.1, 5.1 to 5.2, etc. 



I'd like to know if we are able to jump from edition 5.0 straight to 5.4. "		Technical question	iteraplan Support	17/Nov/16 8:43 PM	12/Apr/17 7:00 AM														"18/Nov/16 8:13 AM;msr;Hi Matthew.

Thank you for your inquiry.

I'd like to distinguish between three different ""parts"" of the iteraplan application:

1) iteraplan webapplication itself on the Tomcat:
You can directly install iteraplan 5.4 and migrate your properties and graphics reactor scripts (if you have any) to your iteraplan 5.4-installation. No intermediate installation steps for 5.1, 5.2, etc are needed.

2) Database:
The database needs to migrated from version to version including all intermediate steps with the help of the database scripts, i.e. 5.0.0 to 5.0.5 to 5.1 to 5.2 to 5.3 and to 5.4. In every version there were some changes on the database structure which need to be included for version 5.4

3) History (if activated)
Only if your history function is activated: (if not, you can ignore the following paragraph):
After running all database migration scripts, you have to run the history migration tool to transfer your old history entries to the new history entry format.

I wish you a great weekend

Marcel"	"29/Nov/16 9:04 PM;mbennett@torontohydro.com;Hi Marcel,

Thanks for your response.

The installation files for iteraplan 5.4 only include the database upgrade files for v5.1 to 5.2, 5.2 to 5.3, and 5.3 to 5.4 .

Would you be able to get me a copy of the upgrade files for 5.0 to 5.0.5, and 5.0.5 to 5.1?

As well, I am unable to find the historymigrationtool.zip folder. Where would this be located? I can’t find it anywhere in iteraplan-5.4.0-corporate-installer.zip

Regards,
Matt


"	"30/Nov/16 9:27 AM;cst;Hi Matt,



thank you for your reply. 



Here the update Scripts for  5.0 to 5.0.5, and 5.0.5 to 5.1.



[^v5.0To5.1.zip]



The History Migration Tool can be downloaded under following link:



https://www.iteraplan.de/downloads/basis/iteraplan-historyMigrationTool.zip 



Login: basis

Password: joA9toup



Greetings, 



Christoph Stangl - iteraplan Support"	"08/Dec/16 3:09 PM;mbennett@torontohydro.com;Hi,

After updating the database with all of the SQL files, I ran the history migration tool by following the steps outlined in the installation guide.

The tool ran for approximately 5 hours, but when I checked the logs, it was filled with [ERROR] messages about not being able to migrate changesets.

I have not started the rest of the upgrade steps, I wanted to check with you first to see if this means the history migration failed. 

I’ve attached the logs for your reference. 


Regards,
Matt


[^iteraplan.log] _(1.59 MB)_

[^migration.log] _(114 kB)_"	"09/Dec/16 9:49 AM;cst;Good Morgning,

could you please open the InfrastructureElement ""CHA-CAR-HP-C7K"" in the version 5.0 - 5.3 
and click on the tab history. 

After this, a Stracktrace will appear, because the history entry of this element is corrupt.
We need this Stracktrace to check the problem with the migration of your history. 

Greetings,

Christoph Stangl - iteraplan Support


"	"12/Dec/16 10:14 PM;mbennett@torontohydro.com;Hi Christoph, 

Do you mean I should check that infrastructure element in our 5.0 environment which has not been upgraded yet?
If yes, then when i click on the history tab, i receive error ""failed to load History content"". 
I did not see any stacktrace appear. I tried this in both IE and chrome. 

Regards,
Matt"	"13/Dec/16 8:54 AM;msr;Hi Matt.

Yes, you should click on this Infrastructure Element and receive above error message. For further analysis we need to see the detailed stacktrace. If it does not occur in iteraplan directly, then it is probably written to the logs.
Could you please send us 

* The exact point in time, when you opened the history tab
* The iteraplan log files from the period, when the error occurred. The files are called “iteraplan-[version].log” (for today) or „iteraplan-[version].log.[TIMESTAMP]” (for past days). The location of these file was specified during installation and is documented in the file “log4j.properties”.
* The “catalina.out” and “localhost.log” files from your tomcat installation (just for the period, when the error occurred).

Thanks in advance

Marcel"	"13/Dec/16 3:32 PM;mbennett@torontohydro.com;I've uploaded two of the logs. There was no catalina.out file generated from that time period. 

I clicked on the history tab at 9:10am on 13/12/2016


Regards,
Matt


[^iteraplan-5.0.0.log] _(13 kB)_

[^localhost_access_log.2016-12-13.txt] _(2 kB)_"	"19/Dec/16 2:33 PM;cst;Hi Matt,

we checked the log files and we cannot find the cause of the problem.
Could you please send us a dump of your database, for analyse the problem on the history migration.

Greetings,

Christoph Stangl - iteraplan Support "	"21/Dec/16 4:04 PM;mbennett@torontohydro.com;Hi Christoph,

To confirm - do you need a database dump of the environment already upgraded to 5.4 version, or the one we have not upgraded yet?


Regards,
Matt"	"22/Dec/16 8:41 AM;cst;Hi Matt,

please could you send us the DUMP, before the history migration was started. 

Greetings,

Christoph Stangl - iteraplan Support "	"22/Dec/16 9:44 PM;mbennett@torontohydro.com;Hi Christoph,

Unfortunately we are unable to provide a database dump, as releasing our infrastructure information is against our security policies. 

Is there another way we can try and troubleshoot this issue?


Regards,
Matt"	"23/Dec/16 8:55 AM;cst;Hi Matt,

at the moment we are working on a update for the migration tool.
After we finished it, I going to send you the upgraded version.

The fix we implemented will  probably solve your problem. 

Greetings,

Christoph Stangl - iteraplan Support



"	"30/Dec/16 3:49 PM;fka;Hello Matt.

some good news just before the end of the year 2016: We've updated the history migration tool. 

Besides some fixes the general reliability of the tool has been improved. The problem you've reported with the history migration should also be fixed with this new release of the tool. The download URL is still the same:

https://www.iteraplan.de/downloads/basis/iteraplan-historyMigrationTool.zip

Login: basis
Password: joA9toup

Best regards
Fabian Kainzinger"	"09/Jan/17 10:46 PM;mbennett@torontohydro.com;Hi,

After running the new migration tool, there was still errors migrating some history content to the new version.


Regards,
Matt"	"10/Jan/17 8:24 AM;cst;Hi Matt, 

could you please attach the latest Log-Files from the migration tool. 

Greetings,

Christoph Stangl - iteraplan Support 
"	"10/Jan/17 10:22 PM;mbennett@torontohydro.com;Attached both logs. 


Regards,
Matt

[^migration.log] _(165 kB)_

[^iteraplan.log] _(1.84 MB)_"	"11/Jan/17 1:50 PM;cst;Hi Matt,

we checked the log-files and we have uploaded a special Version of the migration tool. 
In this version, the log-level is raised for finding your problem. 

With this Version the problem is not fixed, but it will be give us the information for finding the cause of error. 

https://www.iteraplan.de/downloads/basis/iteraplan-historyMigrationTool-analyse.zip 

Login: basis
Password: joA9toup

Greetings,

Christoph Stangl - iteraplan Support 
"	"12/Jan/17 3:18 PM;mbennett@torontohydro.com;Hi,

I've attached the logs from the ""migration tool - analyse"".


Regards,
Matt

[^migration.log] _(107 kB)_

[^iteraplan.log] _(1.36 MB)_"	"16/Jan/17 1:51 PM;cst;Hi Matthew,

thank you for the logs. 

We checked the logs and found no problem in the code, why the tool is exiting without a error message. 
When you execute the tool, which error appears when the migration process stops in the console window? 

Could it be that a Timeout is set on your database? 
It would be very helpful, when you could send us a screenshots of the console window at the moment the migration stops. 

Sorry for this inconvenient steps, without the database the problem is very hard to find.

Greetings,

Christoph Stangl - iteraplan Support "	"24/Jan/17 2:50 PM;mbennett@torontohydro.com;Hi,

We have seemed to resolve the issue, a security policy was preventing the script from running overnight. 

After the batch file running for a one day, we are on Infrastructure element 1120/6798. Is there any way to speed up the process? At this rate, it will take over 5 days for the batch job to run. Having the Iteraplan process down for that long would cause issues. 


Thanks,
 Matt"	"24/Jan/17 3:04 PM;cst;Hi Matt,

thank you for your reply.

There is technically no trick to speed up the procces. 

What you can do is to slim the old history tables and delete entrys there which are older than e.g. 2010. 
Every histroy entry that was ever made is migrate on every element in iteraplan that uses the history.

Thats the reason why this step is taking so long. 

Greetings,

Christoph Stangl - iteraplan Support 
"	"24/Jan/17 9:16 PM;mbennett@torontohydro.com;Is there a way to run the process over the weekend, pause it to bring the application back up Monday, then finish it the following weekend? I'd realize that the history tab would be unavailable during this time, but at least user's would have access to Iteraplan for the work week.

Regards.
Matt"	"25/Jan/17 8:09 PM;mbennett@torontohydro.com;As well, is there an automated way to remove old history entries by a certain date? Is it possible to delete everything from 2012 and older? Or would I need to manually remove them?


Matt"	"26/Jan/17 8:32 AM;cst;Good Morning,



your first request was checked from our developers.

The history migration can not be paused and restarted. 



But you can copy the current database, migrate the history and merge afterwards only the ""new"" history tables with your live system. 

That is possible ;-) 



Here are the steps to clean the old history.



#  Please make a backup from your database

# Open the table „hist_rev_entity“ and look for the column „REVTIMESTAMP“ 

Here starts a special feature - please decide you for a date before the history will be cleared. The values in ""REVTIMESTAMP"" are milliseconds between the creation of the history entry 

and the year ""1970"".  When the dataset was created exactly on the 1.1.2012 has the field the value ""1324598400000 ms"" = ""15330 days"" = ""42 years"".

# Enter the value from step 2 in the script „historydelete.sql“ for the place holder „YOURVALUE“ 

# Execute the script  and after that you can start the migration with the minimized history



Greetings,



Christoph Stangl - iteraplan support"	"31/Jan/17 10:07 PM;mbennett@torontohydro.com;Hi,

Ok sounds good, we can try to trim the history once we get the upgrade working in our dev environment. For now, it looks like we have resolved the migration tool issues, as the batch script seems to have completed successfully. I followed the rest of the steps to complete the installation, but the history tab is not enabled on the new version.  checked the iteraplan properties file, and it looks like the section to enable historization has been removed, like we had in our old installation. Is there a different way to enable this tab in 5.4? 


Regards,
Matt
"	"01/Feb/17 7:58 AM;cst;Hi, 

that are good news. 

The ""History"" can be activated with following clicks:

* Open the ""Interactive Client"" 
* Choose the tab ""Administration"" and ""System"" 
* Here you can be activate the history function

This setting (Activate/Deactivate) will now be saved in the database and not any more in the  iteraplan.properties.

Greetings,

Christoph Stangl - iteraplan Support"	"01/Feb/17 10:01 PM;mbennett@torontohydro.com;Whenever I select ""switch to interactive client"", the page runs out of memory and fails. I checked the logs on the server, and a few error messages were generated. I've attached the logs for your reference. 

We've never had the interactive client enabled before, as it didn't seem to be a feature with 5.0. Not sure if there is something we are missing before the interactive client will work.


Regards,
Matt

[^iteraplan-5.4.0.log] _(246 kB)_

[^iteraplan-5.4.0-nc.log] _(4 kB)_"	"02/Feb/17 9:25 AM;cst;Thats the same problem, why the index cannot be created. 

It is possible to use a current version of Oracle 12c,
or check for the Oracle bug fix/patch No. 18430870 applied to the database. Without the patch iteraplan will not work correctly.

A additonal problem appears, when the Export/Import of Excel is used. 

Greetings,

Chrsitoph Stangl - iteraplan Support
"	"03/Feb/17 9:48 PM;mbennett@torontohydro.com;Hi,

Apparently that oracle patch applies to Linux platform, but not UNIX AIX which is what we run. As well, Oracle 12.2 is not currently available on UNIX AIX, so we couldn't update to 12.2 to resolve the issue.

However, for that bug, Oracle provides the workaround to disable optimizer_adaptive_features parameter. Parameter is dynamic and there is no database restart needed. Our database team applied this workaround, and it resolves all our issues. The index  and interactive client are now working fine in our test environment.


Matt"	03/Feb/17 9:52 PM;mbennett@torontohydro.com;One more question - Could you tell us which tables are being altered when the history migration tool is run? Now that we have it fully working in one environment, we were hoping we could just copy those specific database tables which are changed for the migration tool to the second environment, once it has been upgraded. That would be much faster for us than running the migration tool. 	"06/Feb/17 8:03 AM;cst;Hi, 

thank you for tip for the Oracle database. 

In Version 5.4 following tables were created for the new history:

 HISTORY_AD 
 HISTORY_AD_ADDED_VAL 
 HISTORY_AD_REMOVED_VAL 
 HISTORY_ATT 
 HISTORY_BD 
 HISTORY_BD_ADDED_VAL 
 HISTORY_BD_REMOVED_VAL 
 HISTORY_BF 
 HISTORY_BF_ADDED_VAL 
 HISTORY_BF_REMOVED_VAL 
 HISTORY_BM 
 HISTORY_BM_ADDED_VAL 
 HISTORY_BM_REMOVED_VAL 
 HISTORY_BO 
 HISTORY_BO_ADDED_VAL 
 HISTORY_BO_REMOVED_VAL 
 HISTORY_BP 
 HISTORY_BP_ADDED_VAL 
 HISTORY_BP_REMOVED_VAL 
 HISTORY_BU 
 HISTORY_BU_ADDED_VAL 
 HISTORY_BU_REMOVED_VAL 
 HISTORY_IE 
 HISTORY_IE_ADDED_VAL 
 HISTORY_IE_REMOVED_VAL 
 HISTORY_ISD 
 HISTORY_ISD_ADDED_VAL 
 HISTORY_ISD_REMOVED_VAL 
 HISTORY_ISI 
 HISTORY_ISI_ADDED_VAL 
 HISTORY_ISI_REMOVED_VAL 
 HISTORY_ISR 
 HISTORY_ISR2BO 
 HISTORY_ISR2BO_ADDED_VAL 
 HISTORY_ISR2BO_REMOVED_VAL 
 HISTORY_ISR2IE 
 HISTORY_ISR2IE_ADDED_VAL 
 HISTORY_ISR2IE_REMOVED_VAL 
 HISTORY_ISR_ADDED_VAL 
 HISTORY_ISR_REMOVED_VAL 
 HISTORY_ITS 
 HISTORY_ITS_ADDED_VAL 
 HISTORY_ITS_REMOVED_VAL 
 HISTORY_PROD 
 HISTORY_PROD_ADDED_VAL 
 HISTORY_PROD_REMOVED_VAL 
 HISTORY_PROJ 
 HISTORY_PROJ_ADDED_VAL 
 HISTORY_PROJ_REMOVED_VAL 
 HISTORY_STATE 
 HISTORY_TCR 
 HISTORY_TCR2IE 
 HISTORY_TCR2IE_ADDED_VAL 
 HISTORY_TCR2IE_REMOVED_VAL 
 HISTORY_TCR_ADDED_VAL 
 HISTORY_TCR_REMOVED_VAL 
 HISTORY_TRANS_ADDED_VAL 
 HISTORY_TRANS_REMOVED_VAL 
 HISTORY_TRANSPORT 

On the history migration the data sets are converted from the old history in the tables above. 
This are the tables which must be merged with your ""productive"" environment. 

Greetins,

Christoph Stangl - iteraplan Support"	"06/Mar/17 9:54 PM;mbennett@torontohydro.com;Hi Christoph,

In your steps to delete the old history, you specifed to run the script historydelete.sql. where can i find this script?


Regards,
Matt"	"07/Mar/17 7:54 AM;cst;Hi Bennett,

thank you for your reply. 

With the current Historymigration-Tool it is possible to clean the new History tables. 
He checks for previous migrations and ask you to clean the new history tables and start the history migration again. 

Here are the steps to clean the old history.
 # Please make a backup from your database
 # Open the table „hist_rev_entity“ and look for the column „REVTIMESTAMP“
Here starts a special feature - please decide you for a date before the history will be cleared. The values in ""REVTIMESTAMP"" are milliseconds between the creation of the history entry 
and the year ""1970"". When the dataset was created exactly on the 1.1.2012 has the field the value ""1324598400000 ms"" = ""15330 days"" = ""42 years"".
 # Enter the value from step 2 in the script „historydelete.sql“ for the place holder „YOURVALUE“
 # Execute the script and after that you can start the migration with the minimized history

[^deletehistory.sql]

Greetings,

Christoph Stangl - iteraplan Support

 "	"17/Mar/17 8:33 PM;mbennett@torontohydro.com;Hi,

I've noticed that while we have the historization enabled, the history tab does not show up when in classic view. However if i switch to the interactive client, then the history tab shows up. 

As well, we have some issues with the interactive client where it can be extremely inconsistent, with the site crashing when it needs to load lots of data. Sometimes it works, but sometimes it doesnt. Is there a change we can make so that the interactive client works more smoothly?


Regards,
Matt"	"20/Mar/17 11:20 AM;cst;Hi Matt,

the new history is ony shown in the interactive client. With the release 5.5 we optimized a lot on the performance in the interactive client. 
Additional we created a new button in the classic client to jump directly in the history of a element. 

My advice is to upgrade on Version 5.5. 

Greetings,

Christoph Stangl - iteraplan Support"	"20/Mar/17 7:44 PM;mbennett@torontohydro.com;Could you please send the upgrade files for 5.5?


Regards,
Matt Bennett"	"21/Mar/17 8:03 AM;cst;No Problem:

[Download iteraplan 5.5|https://www.iteraplan.de/downloads/corporate/5.5.0/iteraplan-5.5.0-corporate-installer.zip]

Login: corporate
Password: nbAT01Qx

Greetings,

Christoph Stangl - iteraplan Support "	"23/Mar/17 9:06 PM;mbennett@torontohydro.com;Is a new migration tool required for the new version? or am I able to run the old one?


Regards,
Matt"	"24/Mar/17 7:36 AM;cst;Good Morning Matt, 

if the history migration of the version 5.4 was succesfull, it is not nessercery to execute the history migration again with 5.5. 
When you execute the history migration tool on version 5.5. You can use the same tool for that.

Greetings,

Christoph Stangl - iteraplan Support"	"12/May/17 3:11 PM;mbennett@torontohydro.com;Thanks for your help Christoph, we were able to upgrade successfully to 5.5.

Regards,
Matt"														
