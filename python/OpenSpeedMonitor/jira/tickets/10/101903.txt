History migration tool for iteraplan 5.4 crashes at start	"Hi iteraplan team,



when running the history migration tool for iteraplan 5.4, it immediately crahes with the following exception:



./migrateHistory.sh

iteraplan history migration tool started...

Exception in thread ""main"" org.springframework.beans.factory.xml.XmlBeanDefinitionStoreException: Line 1 in XML document from class path resource [applicationContext.xml] is invalid; nested exception is org.xml.sax.SAXParseException; systemId: http://www.springframework.org/schema/context/spring-context-4.1.xsd; lineNumber: 1; columnNumber: 1; Premature end of file.

        at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadBeanDefinitions(XmlBeanDefinitionReader.java:399)

        at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:336)

        at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:304)

        at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:181)

        at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:217)

        at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:188)

        at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:252)

        at org.springframework.context.support.AbstractXmlApplicationContext.loadBeanDefinitions(AbstractXmlApplicationContext.java:127)

        at org.springframework.context.support.AbstractXmlApplicationContext.loadBeanDefinitions(AbstractXmlApplicationContext.java:93)

        at org.springframework.context.support.AbstractRefreshableApplicationContext.refreshBeanFactory(AbstractRefreshableApplicationContext.java:129)

        at org.springframework.context.support.AbstractApplicationContext.obtainFreshBeanFactory(AbstractApplicationContext.java:609)

        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:510)

        at org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:139)

        at org.springframework.context.support.ClassPathXmlApplicationContext.<init>(ClassPathXmlApplicationContext.java:83)

        at de.iteratec.iteraplan.historyMigrationTool.Main.main(Main.java:24)

Caused by: org.xml.sax.SAXParseException; systemId: http://www.springframework.org/schema/context/spring-context-4.1.xsd; lineNumber: 1; columnNumber: 1; Premature end of file.

        at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:203)

        at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:177)

        at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:400)

        at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:327)

        at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1465)

        at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(XMLDocumentScannerImpl.java:1019)

        at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:606)

        at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(XMLNSDocumentScannerImpl.java:118)

        at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:504)

        at com.sun.org.apache.xerces.internal.impl.xs.opti.SchemaParsingConfig.parse(SchemaParsingConfig.java:629)

        at com.sun.org.apache.xerces.internal.impl.xs.opti.SchemaParsingConfig.parse(SchemaParsingConfig.java:685)

        at com.sun.org.apache.xerces.internal.impl.xs.opti.SchemaDOMParser.parse(SchemaDOMParser.java:530)

        at com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDHandler.getSchemaDocument(XSDHandler.java:2171)

        at com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDHandler.parseSchema(XSDHandler.java:569)

        at com.sun.org.apache.xerces.internal.impl.xs.XMLSchemaLoader.loadSchema(XMLSchemaLoader.java:613)

        at com.sun.org.apache.xerces.internal.impl.xs.XMLSchemaValidator.findSchemaGrammar(XMLSchemaValidator.java:2446)

        at com.sun.org.apache.xerces.internal.impl.xs.XMLSchemaValidator.handleStartElement(XMLSchemaValidator.java:1767)

        at com.sun.org.apache.xerces.internal.impl.xs.XMLSchemaValidator.emptyElement(XMLSchemaValidator.java:760)

        at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.scanStartElement(XMLNSDocumentScannerImpl.java:357)

        at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2781)

        at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:606)

        at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(XMLNSDocumentScannerImpl.java:118)

        at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:504)

        at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:848)

        at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:777)

        at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:141)

        at com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(DOMParser.java:243)

        at com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(DocumentBuilderImpl.java:339)

        at org.springframework.beans.factory.xml.DefaultDocumentLoader.loadDocument(DefaultDocumentLoader.java:76)

        at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadDocument(XmlBeanDefinitionReader.java:429)

        at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadBeanDefinitions(XmlBeanDefinitionReader.java:391)

        ... 14 more





In our opinion, all specified preconditions for the history migration are fulfilled.

Please provide further advice. Thank you."		Fault	iteraplan Support	08/Nov/16 9:05 AM	15/Nov/16 12:34 PM														08/Nov/16 9:07 AM;matthias.habermann@wacker.com;For your information, both log files (migration.log and iteraplan.log) are empty.	"08/Nov/16 9:26 AM;cst;Dear Mr. Habermann,

thank you for your inquiry.

Would you please download the following ""History Migration Tool"" to solve the problem.

https://www.iteraplan.de/downloads/basis/iteraplan-historyMigrationTool-2.zip 

The user name and password is the same as the orginal ""History Migration Tool"". 

Greetings,

Christoph Stangl - iteraplan Support"	"08/Nov/16 3:44 PM;matthias.habermann@wacker.com;Dear Mr. Stangl,

thak you for the new version of the History Migration Tool. It did start the migration this time, but unfortunately crashed with a NPE:

....Exception in thread ""main"" java.lang.NullPointerException
        at de.iteratec.iteraplan.historyMigrationTool.GeneralEntityFactory.generateEntitiesForCommonChanges(GeneralEntityFactory.java:248)
        at de.iteratec.iteraplan.historyMigrationTool.GeneralEntityFactory.generateEntities(GeneralEntityFactory.java:50)
        at de.iteratec.iteraplan.historyMigrationTool.MigrationService.generateHistoryForType(MigrationService.java:161)
        at de.iteratec.iteraplan.historyMigrationTool.MigrationService.migrateOldHistoryChangesets(MigrationService.java:93)
        at de.iteratec.iteraplan.historyMigrationTool.MigrationService.migrate(MigrationService.java:56)
        at de.iteratec.iteraplan.historyMigrationTool.Main.main(Main.java:31)


Please find the logs attached. Could you please investigate this issue?

I suspect the database is now in a corrupt/inconsistent state. Do we have to recover the previous state?

Kind regards
Matthias Habermann

[^iteraplan.log] _(5 kB)_

[^migration.log] _(55 kB)_"	"08/Nov/16 4:50 PM;cst;Dear Mr. Habermann,

could please send us the logfiles again? It seems that they are incomplete. 
After the error does the ""Migration Tool"" stop, or is the migration finished?

When you want, I will be send you a script for reseting the new History tables. 
Which database do you use?

Greetings, 

Christoph Stangl - iteraplan Support 
"	"08/Nov/16 5:21 PM;matthias.habermann@wacker.com;The migration stops with the error, therefore the provided log files are inherently incomplete.

Yes, please provide me the script for resetting the history tables. We use an Oracle DB. Is it guaranteed that the script can reset the history tables correctly if the migration was not finished or is it safer to just reset the DB to the timestamp before the migration?

[^iteraplan.log] _(5 kB)_

[^migration.log] _(55 kB)_"	"09/Nov/16 10:07 AM;cst;Dear Mr. Habermann,



thank you for your reply.



We checked the error message + log files. Could you please replace the ""historyMigrationTool.jar"" from the following ZIP-File on your Server. 



https://www.iteraplan.de/downloads/basis/historyMigrationTool-wacker.zip



After that, use the timestamp before the first migration (is the cleaner way) and start the migraion again. 



Greetings,



Christoph Stangl - iteraplan Support 

"	"10/Nov/16 5:20 PM;matthias.habermann@wacker.com;The migration tool did finish this time.

Nevertheless some changesets could not be migrated:

[2016-11-10 15:00:03] Migrating change history of BusinessUnit 16/33 - ID: 44
[2016-11-10 15:00:03] Could not migrate changeset:2014-09-11T16:54:54.249+02:00;hildenb-al;44;Wacker Chemie AG;207;Index: 27, Size: 22
[2016-11-10 15:00:03] Could not migrate changeset:2015-04-26T19:51:28.908+02:00;suchetmir;44;Wacker Chemie AG;269;Index: 27, Size: 22
[2016-11-10 15:00:03] Could not migrate changeset:2015-04-26T19:52:46.817+02:00;suchetmir;44;Wacker Chemie AG;270;Index: 27, Size: 22
[2016-11-10 15:00:03] Could not migrate changeset:2015-04-26T19:53:55.281+02:00;suchetmir;44;Wacker Chemie AG;271;Index: 27, Size: 22
[2016-11-10 15:00:03] Could not migrate changeset:2015-04-26T19:56:32.742+02:00;suchetmir;44;Wacker Chemie AG;272;Index: 27, Size: 22
[2016-11-10 15:00:03] Could not migrate changeset:2015-04-26T19:57:10.570+02:00;suchetmir;44;Wacker Chemie AG;273;Index: 27, Size: 22
[2016-11-10 15:00:03] Could not migrate changeset:2015-04-26T19:59:00.071+02:00;suchetmir;44;Wacker Chemie AG;274;Index: 27, Size: 22
[2016-11-10 15:00:03] Could not migrate changeset:2016-01-31T21:27:58.245+01:00;suchetmir;44;Wacker Chemie AG;311;Index: 27, Size: 22
[2016-11-10 15:00:03] Could not migrate changeset:2016-01-31T21:37:18.951+01:00;suchetmir;44;Wacker Chemie AG;312;Index: 27, Size: 23
"	"10/Nov/16 5:23 PM;matthias.habermann@wacker.com;The cause seems to be:
java.lang.IndexOutOfBoundsException: Index: 27, Size: 22

We will reset the DB again. Could you please investigate? Thank you.

[^migration.log] _(327 kB)_"	"11/Nov/16 9:36 AM;cst;Could you please send us the current iteraplan.log from the migration tool.
After that, we going to check the problem. 

Greetings,

Christoph Stangl - iteraplan Support "	"11/Nov/16 10:00 AM;matthias.habermann@wacker.com;Please find the iteraplan.log attached.

[^iteraplan.log] _(55 kB)_"	"11/Nov/16 1:28 PM;cst;I checked the Log-Files and the migration was successful.

The  errors are histroy entrys, which are not correct in the old history (corrupted entries for time). 
All other points of the history are transfered in the new history.

For this errors whe have no technical sollution.

Please note, in the classic client this History Elements cannot be opened.
In the new History this can be opened but the corrupted entries are not will be loaded.

Greetings,

Christoph Stangl - iteraplan Support"	"11/Nov/16 3:50 PM;matthias.habermann@wacker.com;Thanks for your evaluation. Important for us to know remains what could have caused the corrupt entries. Do you have an idea? What exactly do you mean with ""corrupted entries for time""?

Do you have a suggestion how we could possibly check the productive DB (via SQL) for corrupt entries before we attempt the history migration there (the data in the dev, test and prod DBs are not identical in our case)?"	"14/Nov/16 8:44 AM;cst;In the old history it happened, that wrong values were transferred into the database. 
For e.g. changing the Name of the Information System (IS A1).  

After that, you cannot open the history tab e.g. for the Information System (IS A1) anymore.
Thats was one of the reasons, we changed to a ""new"" history. 

The migration tool cannot migrate this corrupted entries, because they are incomplete or false. 

But in the new History the correct created history entries of the Information System (IS A1) can be loaded in the overview. 
(In the old History nothing was shown, when this problem appears) 

A technical solution to check corrupted entries and fix it before the migration stats, is not possible.

Greetings, 

Christoph Stangl - iteraplan Support 

(Wenn gewünscht, können wir den Fall auch gerne in Deutsch weiter besprechen) 
"	"14/Nov/16 1:54 PM;matthias.habermann@wacker.com;D.h. die korrupten Einträge sind über die iteraplan-Oberfläche in die Datenbank gekommen? Kann das mit einer aktuellen Version immer noch passieren oder werden solche Eingaben über die Oberfläche mittlerweile zurückgewiesen?

Haben Sie ein Beispiel für einen falschen Wert z.B. den Namen eines Informationssystems?

Uns geht es nur darum, das besser einschätzen zu können und korrupte Einträge in Zukunft zu vermeiden.

Vielen Dank."	"14/Nov/16 2:04 PM;cst;Ein Beispiel ist die Tabellenspalte ""Timestamp"", hier kann das Format nicht korrekt übertragen worden sein und danach tritt der Fehler auf.

In der neuen History kann das Verhalten nicht mehr auftreten, da die History hier komplett neu in die Software implementiert wurde. 
Wenn Sie mit der Version 5.4 arbeiten, werden solche Einträge nicht mehr in die Datenbank geschrieben und die History bleibt sauber.

Wie man herausfinden kann, welche Datensätze das betrifft, müsste ich mit unseren Entwicklern klären.
Hier kann es aber verschiedene Ursachen und Fehler geben, das es wirklich kompliziert ist dies zu korrigieren (teilweise gar nicht mehr möglich)."	"15/Nov/16 12:14 PM;matthias.habermann@wacker.com;OK, das reicht uns so vorerst aus.

Eine Frage habe ich noch: Ist die zuletzt bereitgestellte Version des Migrationstools Wacker-spezifisch, so dasss wir sie wegsichern müssen, oder wird sie zu der offiziell downloadbaren Version werden?"	"15/Nov/16 12:34 PM;cst;Die Datei wird in die offiziell downloadbaren Version werden.

Ab 13:00 steht diese dann zum download zur Verfügung.



Sie müssen die Datei nicht separat weggesichert werden. 



Viele Grüße,



Christoph Stangl

"	"15/Nov/16 12:36 PM;matthias.habermann@wacker.com;Vielen Dank für Ihre Unterstützung!

Viele Grüße
Matthias Habermann"																																					
