Iteraplan 5.2 - Fehler 500 - Interner Serverfehler	"Hallo Herr Schrumpf,



wie bereits per Email kommuniziert, erhalten wir einen Fehler 500 - Interner Serverfehler.

Die Logfiles haben Sie bereits per Email vorab bekommen.



---

Weitere Informationen:

Auf diesem Server setzen wir Iteraplan 5.2, Java 1.7.0.80 und Tomcat 7.0.69 ein.

Das Workverzeichnis wurde bereits gelöscht und der Tomcatserver durchgestartet.

Der genannte Oracle Bug Fix ist eingespielt (aktueller JDBC-Treiber ist eingespielt).



Die Logfiles sende ich Ihnen im Anhang mit der Bitte um Prüfung."		Fault	iteraplan Support	24/Jun/16 1:50 PM	11/Jul/16 8:48 AM														"27/Jun/16 1:08 PM;msr;Hallo Herr Deichmüller,

danke, dass Sie für diesen Fall ein Ticket eröffnet haben.
In den angehängten Log-Dateien finde ich keinen Fehler, der auf den 500er-Fehler hinweist: Weder im iteraplan-Log noch im Tomcat-Log tauchen Fehlermeldungen auf. Im Access Log taucht ein Server-Antwort 401 ""Unauthorized"" auf. Deshalb meine Fragen:

* Könnten Sie bitte den Fehler lokal reproduzieren und mir nochmal die Log-Dateien von dem entsprechenden Zeitpunkt schicken?
* Wann genau tritt der 500er-Fehler auf? Noch vor dem Einloggen oder direkt nach dem Einloggen oder auf einer speziellen Unterseite?

Mit freundlichen Grüßen"	"27/Jun/16 2:12 PM;christian.deichmueller@huk-coburg.de;Hallo Herr Schrumpf,

ich habe den Fehler reproduziert.
Anbei finden Sie die Logs von Iteraplan, IIS und Tomcat-Server.

Der Fehler tritt auf, sobald ich die Adresse des Webservers eingebe:

https://ams-tut7/iteraplan

bei uns.


[^iislog.zip] _(0,5 kB)_

[^iteraplan_log.zip] _(0,9 kB)_

[^tomcatlog.zip] _(7 kB)_"	"28/Jun/16 11:45 AM;msr;Hallo Herr Deichmüller,

ich möchte Sie bitten, die Hibernate Search Indizes zu löschen. Diese können später in iteraplan wieder neu erstellt werden.
Sie können das Verzeichnis der Indizes mit Hilfe der Datei $TOMCAT_HOME/ webapps/iteraplan/WEB-INF/classes/iteraplan.properties unter der property: hibernate.search.index.

Könnten Sie bitte den Tomcat davor herunterfahren, das Work-Verzeichnis erneut löschen und danach neustarten?

Vielen Dank."	"28/Jun/16 1:33 PM;christian.deichmueller@huk-coburg.de;Hallo Herr Schrumpf,

alles durchgeführt - ohne Erfolg.

Unverändertes Bild."	"30/Jun/16 8:46 AM;msr;Hallo Herr Deichmüller,

ich würde gerne mit Ihnen persönlich das weitere Vorgehen absprechen. Wäre es möglich heute oder morgen oder nächste Woche miteinander zu telefonieren?
Wenn ja, unter welcher Telefonnummer kann ich Sie wann erreichen?

Mit freundlichen Grüßen"	"30/Jun/16 9:04 AM;christian.deichmueller@huk-coburg.de;Hallo Herr Schrumpf,

sie können mich gerne sofort kontaktieren.

Zwischen 10-11 Uhr habe ich ein Meeting und ab 14-16 Uhr.

Telefonnummer:
09561 - 96 - 61432"	"30/Jun/16 1:25 PM;msr;Hallo Herr Deichmüller,

wie gerade telefonisch besprochen möchte ich Sie bitten, mir die BonCode-Logs zu schicken.

Unter folgendem Link: https://www.iteraplan.de/doc/display/iteraplan52/Single+Sign+On steht ganz unten unter der Überschrift ""Debugging help"", wie man das BonCode-Logging aktiviert. Bitte schicken Sie mir entsprechende Log-Files zu.

Vielen Dank."	30/Jun/16 2:08 PM;msr;Es handelt sich um *keine* Datenbankmigration, sondern um eine Erstinstallation von iteraplan 5.2 in dieser neuen Umgebung.	"04/Jul/16 7:59 AM;christian.deichmueller@huk-coburg.de;Hallo Herr Schrumpf,

ich habe die Änderungen durchgeführt, jedoch bekomme ich kein BonCode-Log.

Die BonCodeAJP13.settings-Datei existiert in drei verschiedenen Verzeichnissen:

C:\Windows
C:\Inetpub\Iteraplan\BIN
C:\Inetpub\wwwroot\BIN

Anbei übersende ich Ihnen noch unsere Konfigeinstellungen von Boncode und Tomcat.

[^BonCodeAJP13.settings] _(0,3 kB)_

[^server.xml] _(8 kB)_"	"04/Jul/16 8:42 AM;christian.deichmueller@huk-coburg.de;Hallo Herr Schrumpf,

ich habe die Rechte für das Logverzeichnis noch angepasst.
Jetzt kommt auch ein Log.

[^BonCodeAJP13Connection_1_SAPL7011_20160704.log] _(42 kB)_"	"05/Jul/16 8:50 AM;msr;Hallo Herr Deichmüller,

danke für das Zusenden der IIS-Logs. Die Analyse der Log-Dateien deutet darauf hin, dass der IIS entsprechende Requests schickt, mit denen iteraplan nicht umgehen kann. Aber die Struktur der Requests, die man in den IIS-Logs sieht, scheint in Ordnung zu sein. Deshalb möchten wir nun untersuchen, wie diese Requests von iteraplan verarbeitet werden. Dazu möchte ich Sie bitten, dass ""Spring Loggging"" auf DEBUG zu stellen. Siehe dazu https://www.iteraplan.de/doc/pages/viewpage.action?pageId=6848548:

""If you have installed iteraplan with LDAP authentication correctly, you should be able to login with a user of the chosen supervisor group in iteraplan, after a restart of Tomcat.

If the login does not work, then a higher log level is very useful for diagnosis. Add the following four lines to the file $TOMCAT_HOME\webapps\iteraplan-ldap\WEB-INF\classes\log4j.properties, within the section ""Spring logging"" in that file:
log4j.logger.org.springframework.security.ldap=DEBUG
log4j.logger.org.springframework.security.ui.webapp=DEBUG
log4j.logger.org.springframework.security.web.authentication=DEBUG
log4j.logger.org.springframework.ldap=DEBUG""

Bitte schicken Sie mir entsprechende Logs zu.

Danke schön."	"05/Jul/16 9:26 AM;christian.deichmueller@huk-coburg.de;Anbei die Logs.

[^logs.zip] _(18 kB)_"	"07/Jul/16 10:01 AM;msr;Hallo Herr Deichmüller,

hier der aktuelle Stand unserer Analyse mit den Hilfer Ihrer Logs:
* Der IIS reicht LDAP-Informationen an iteraplan weiter.
* ABER iteraplan findet bei der Suche in LDAP nicht Ihren user und auch kein anderes Ergebnis

Deshalb wäre mein Vorschlag:
* Wenn Sie bereits eine funktionierende LDAP-Installation bei der HUK haben, könnten Sie bitte die iteraplan-auth.properties dieser beiden Instanzen (der funktionierenden und der neuen) vergleichen?
* Wenn Sie keine funktionierende LDAP-Installation bei der HUK haben, könnten Sie bitte die iteraplan-auth.properties auf Tipp-Fehler o.ä. überprüfen?
* Könnten Sie zusätzlich prüfen, ob Sie vom neuen iteraplan-Server im LDAP folgenden String suchen können: ""ou=iteratec,ou=applikationen,dc=t7,dc=lan,dc=tuhuk,dc=de"" mit Filter ""(&(sAMAccountName={0})(objectClass=user))"", wobei {0} für Ihren User steht.

Wenn es Ihnen möglich ist, würde ich mich freuen, mich morgen nochmal mit Ihnen zu diesem Thema telefonisch auszutauschen."	"07/Jul/16 10:34 AM;msr;Tipp von Stephan:
Lokal nachstellen und testen, ob im iteraplan-Log selbe Statements drinstehen (bei gleichen Log-Einstellungen)"	"07/Jul/16 10:53 AM;christian.deichmueller@huk-coburg.de;Hallo Herr Schrumpf,

das war auch mein Verdacht.

Was mir auffällt in Ihrer iteraplan-auth.properties ist der Parameter:

Alle Versionen vor 5.2 verwenden:
ldap.roles.searchbase=ou=iteratec,ou=Applikationen

Ab 5.2 wird der Parameter:
ldap.users.searchbase=ou=iteratec,ou=Applikationen

verwendet.

Ich habe beide Varianten geprüft, leider kein Erfolg.

Mit welchen Mitteln kann ich vom Iteraplan-Server aus, den LDAP-String durchsuchen lassen?
"	"07/Jul/16 11:22 AM;christian.deichmueller@huk-coburg.de;Anbei noch das Log mit dem geänderten Parameter auf:
ldap.roles.searchbase=ou=iteratec,ou=Applikationen


[^iteraplan-5.2.0.zip] _(2 kB)_"	"07/Jul/16 11:39 AM;msr;Hallo Herr Deichmüller,

könnten Sie uns bitte die iteraplan-auth.properties der Version 5.2 bereitstellen (in der ursprünglichen Konfiguration als die obigen Fehler aufgetreten sind)?

Zum Durchsuchen von LDAP gibt es verschiedene Tools. Am besten Sie suchen einfach nach ""LDAP Browser"" + [Betriebssystem]. Unter Windows gibt es auch ein Tool, das genau so heißt. Die meisten Tools sollten diese Funktionalität mitbringen."	"07/Jul/16 12:17 PM;christian.deichmueller@huk-coburg.de;Hallo Herr Schrumpf,

anbei die iteraplan-auth.properties.

[^iteraplan-auth.properties] _(4 kB)_"	"07/Jul/16 2:07 PM;msr;Hallo Herr Deichmüller,



ich habe die iteraplan-auth.properties leicht geändert: Den Wert von ldap.users.searchbase nach ldap.roles.searchbase kopiert, aber beide Properties da gelassen. Könnten Sie die angehängte Datei in iteraplan einfügen, dem Tomcat neustarten und mir die Logs schicken, falls es wieder zu einem Fehler kommt.



Hintergrund: Beide properties müssen in dem File existieren, aber nicht gesetzt sein. Beide properties schränken die LDAP-Suche ein. Bei der user.searchbase werden die Benutzer nur aus einem Teilbaum im Active Directory gesucht, bei roles.searchbase werden die Rollen nur aus einem Teilbaum im Active Directory gesucht. Meine Vermutung ist, dass zweiteres also applikationsspezifische Rollen eher Ihrem Setup entspricht.[^iteraplan-auth.properties]

"	"11/Jul/16 7:23 AM;christian.deichmueller@huk-coburg.de;Hallo Herr Schrumpf,

so wie ich die Meldung interpretiere, gibt es ein Lizenzproblem mit Iteraplan.
Müssen wir noch ein Lizenzfile einspielen?



[^iteraplan-5.2.0.log] _(9 kB)_

[^Tomcatlogs.zip] _(9 kB)_"	"11/Jul/16 7:52 AM;christian.deichmueller@huk-coburg.de;Hallo Herr Schrumpf,

ich habe den Key eingespielt, nun funktioniert auch der Aufruf."	"11/Jul/16 8:17 AM;msr;Hallo Herr Deichmüller,

das freut mich sehr. Schließlich habe ich auch bei diesem Fall sehr ""mitgefiebert"".

Verstehe ich Sie richtig, dass der Fall gelöst ist?

Viele Grüße

M. Schrumpf"	"11/Jul/16 8:41 AM;christian.deichmueller@huk-coburg.de;Hallo Herr Schrumpf,

der Fall kann geschlossen werden."	"11/Jul/16 8:48 AM;msr;Hallo Herr Deichmüller,

das sind gute Nachrichten. Ihnen eine schöne Woche"																															
